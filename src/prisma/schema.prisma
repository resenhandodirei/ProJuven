generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/**
 * ===== ENUMS =====
 */

enum TipoDePerfilEnum {
  ADMIN
  DEFENSOR
  PSICOSSOCIAL
  SERVIDOR
  ESTAGIARIO
}

/**
 * ===== MODELS =====
 */

/**
 * Usuários / contas de login
 */
model Login {
  id           Int              @id @default(autoincrement())
  nome         String           @db.VarChar(100)
  genero       String?          @db.VarChar(20)
  tipoDePerfil TipoDePerfilEnum @map("tipo_de_perfil")
  email        String           @unique @db.VarChar(255)
  senha        String           @db.VarChar(255)

  fichas              Ficha[]                  @relation("CriadorFicha")
  prontuariosJuridico ProntuarioJuridico[]     @relation("CriadorProntuarioJuridico")
  prontuariosPsico    ProntuarioPsicossocial[] @relation("CriadorProntuarioPsicossocial")

  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt

  @@map("login")
}

/**
 * Ficha com campos obrigatórios e opcionais, 
 * respeitando as regras de quem cria (Servidor ou outras personas).
 */ 

model Ficha {
  id               String   @id @default(uuid())
  nomeAtendido     String   @map("nome_atendido")
  nomeFamiliar     String?  @map("nome_familiar") // obrigatório só p/ algumas personas
  cpf              String?  @map("cpf")
  rg               String?  @map("rg")
  dataNascimento   DateTime? @map("data_nascimento")

  qtdProcesso      Int?     @map("qtd_processo")
  numeroProcesso   String?  @map("numero_processo") // pode ser 1 ou vários
  varaProcesso     String?  @map("vara_processo")   // ex: "5ª Vara"
  
  telefonesContato String[] @map("telefones_contato") // servidor precisa registrar vários
  nomeResponsavel  String?  @map("nome_responsavel")
  documentoResponsavel String? @map("documento_responsavel") // cpf ou rg do responsável
  endereco         String?  @map("endereco")

  idUsuarioCriador Int      @map("id_usuario_criador") 
  criador          Login    @relation("CriadorFicha", fields: [idUsuarioCriador], references: [id])

  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  ProntuarioJuridico     ProntuarioJuridico[]
  ProntuarioPsicossocial ProntuarioPsicossocial[]

  @@map("ficha")
}

/**
 * ===== PRONTUÁRIOS (estrutura básica pronta para expansão) =====
 */

// ENUNS DOS PRONTUÁRIOS
// Pessoas que atendem
enum PessoaQueAtendeu {
  DEFENSOR_RUBENS      @map("Defensor Dr. Rubens")
  DEFENSORA_LUCIANA    @map("Defensora Dra. Luciana")
  DEFENSORA_ANDREIA    @map("Defensora Dra. Andreia")
  ASSESSOR_PEDRO       @map("Assessor jurídico Dr. Pedro")
  ESTAGIARIO_ALEX      @map("Estagiário Alex")
  ESTAGIARIO_ALAN      @map("Estagiário Alan")
  ESTAGIARIA_GABRIELLE @map("Estagiária Gabrielle")
  ESTAGIARIO_GUSTAVO   @map("Estagiário Gustavo Cícero")
  ESTAGIARIA_LARISSA   @map("Estagiária Larissa Corrêa")
  ESTAGIARIO_MARCOS    @map("Estagiário Marcos")
  ESTAGIARIA_RAYANE    @map("Estagiária Rayane")
  ESTAGIARIA_THAYNA    @map("Estagiária Thayná Evelyn")
}

// Defensores responsáveis
enum DefensorResponsavel {
  DEFENSOR_RUBENS    @map("Defensor Dr. Rubens")
  DEFENSORA_LUCIANA  @map("Defensora Dra. Luciana")
  DEFENSORA_ANDREIA  @map("Defensora Dra. Andreia")
}

// Tipos fixos de crime
enum TipoCrime {
  PATRIMONIO @map("Patrimonio")
  VIDA       @map("Vida")
  HONRA      @map("Honra")
  DROGAS     @map("Drogas")
  ARMAS      @map("Armas")
  SEXUAL     @map("Sexual")
  OUTROS     @map("Outros")
}

// Tipo de parentesco
enum Parentesco {
  MAE       @map("Mãe")
  PAI       @map("Pai")
  IRMA      @map("Irmã")
  IRMAO     @map("Irmão(ã)")
  TIOS      @map("Tios")
  AVOS      @map("Avos")
  NORA      @map("Nora")
  CUNHADO   @map("Cunhado(a)")
  OUTROS    @map("Outros")
}

// MODELS
model Jovem {
  id             Int       @id @default(autoincrement())
  nome           String
  dataNascimento DateTime
  criadoEm       DateTime  @default(now())
  atualizadoEm   DateTime  @updatedAt
  processos      Processo[]
  familiares     Familiar[]
}

model Familiar {
  id                  Int        @id @default(autoincrement())
  jovemId             Int
  jovem               Jovem      @relation(fields: [jovemId], references: [id], onDelete: Cascade)
  nome                String
  parentesco          Parentesco
  responsavelPrincipal Boolean   @default(false)
  contatos            ContatoFamiliar[]
}

model ContatoFamiliar {
  id          Int        @id @default(autoincrement())
  familiarId  Int
  familiar    Familiar   @relation(fields: [familiarId], references: [id], onDelete: Cascade)
  telefone    String
  parentesco  Parentesco?
}

model Processo {
  id          Int        @id @default(autoincrement())
  jovemId     Int
  jovem       Jovem      @relation(fields: [jovemId], references: [id], onDelete: Cascade)
  numero      String
  tipoCrime   TipoCrime
  descricao   String?
  criadoEm    DateTime   @default(now())
  atendimentos Atendimento[]
}

model Atendimento {
  id                 Int                 @id @default(autoincrement())
  processoId         Int
  processo           Processo            @relation(fields: [processoId], references: [id], onDelete: Cascade)
  pessoaQueAtendeu   PessoaQueAtendeu
  defensorResponsavel DefensorResponsavel
  criadoEm           DateTime            @default(now())
  atualizadoEm       DateTime            @updatedAt
}

/**
 * ===== PRONTUÁRIOS (ESTRUTURA INICIAL) =====
 */

model ProntuarioJuridico {
  id String @id @default(uuid())

  idUsuarioCriador Int   @map("id_usuario_criador")
  criador          Login @relation("CriadorProntuarioJuridico", fields: [idUsuarioCriador], references: [id])

  // ligação opcional com ficha
  fichaId String?
  ficha   Ficha?  @relation(fields: [fichaId], references: [id])

  // campos básicos iniciais (adicione mais conforme a checklist)
  pessoaQueAtendeu String?   @map("pessoa_que_atendeu")
  numeroProcesso   String?   @map("numero_processo")
  nomeJovem        String?   @map("nome_jovem")
  cpf              String?   @map("cpf")
  dataNascimento   DateTime? @map("data_nascimento")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("prontuario_juridico")
}

model ProntuarioPsicossocial {
  id String @id @default(uuid())

  idUsuarioCriador Int   @map("id_usuario_criador")
  criador          Login @relation("CriadorProntuarioPsicossocial", fields: [idUsuarioCriador], references: [id])

  fichaId String?
  ficha   Ficha?  @relation(fields: [fichaId], references: [id])

  // campos iniciais
  avaliacaoInicial  String? @map("avaliacao_inicial")
  historicoFamiliar String? @map("historico_familiar")
  observacoes       String? @map("observacoes")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("prontuario_psicossocial")
}
